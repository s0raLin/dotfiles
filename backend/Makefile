# Linux é…ç½®ç®¡ç†å™¨åç«¯ Makefile

# å˜é‡å®šä¹‰
BINARY_NAME=linux-config-manager
BUILD_DIR=bin
CMD_DIR=cmd/server
MAIN_FILE=$(CMD_DIR)/main.go

# é»˜è®¤ç›®æ ‡
.PHONY: all
all: clean build

# æ¸…ç†æ„å»ºæ–‡ä»¶
.PHONY: clean
clean:
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶..."
	@rm -rf $(BUILD_DIR)
	@go clean

# æ„å»ºåº”ç”¨
.PHONY: build
build:
	@echo "ğŸ”¨ æ„å»ºåº”ç”¨..."
	@mkdir -p $(BUILD_DIR)
	@go build -o $(BUILD_DIR)/$(BINARY_NAME) $(MAIN_FILE)
	@echo "âœ… æ„å»ºå®Œæˆ: $(BUILD_DIR)/$(BINARY_NAME)"

# è¿è¡Œå¼€å‘æœåŠ¡å™¨
.PHONY: dev
dev:
	@echo "ğŸš€ å¯åŠ¨å¼€å‘æœåŠ¡å™¨..."
	@go run $(MAIN_FILE)

# è¿è¡Œæµ‹è¯•
.PHONY: test
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	@go test -v ./...

# æ ¼å¼åŒ–ä»£ç 
.PHONY: fmt
fmt:
	@echo "ğŸ“ æ ¼å¼åŒ–ä»£ç ..."
	@go fmt ./...

# ä»£ç æ£€æŸ¥
.PHONY: vet
vet:
	@echo "ğŸ” ä»£ç æ£€æŸ¥..."
	@go vet ./...

# ä¸‹è½½ä¾èµ–
.PHONY: deps
deps:
	@echo "ğŸ“¦ ä¸‹è½½ä¾èµ–..."
	@go mod download
	@go mod tidy

# è¿è¡Œæ„å»ºçš„åº”ç”¨
.PHONY: run
run: build
	@echo "ğŸš€ è¿è¡Œåº”ç”¨..."
	@./$(BUILD_DIR)/$(BINARY_NAME)

# å¥åº·æ£€æŸ¥
.PHONY: health
health:
	@echo "ğŸ¥ æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€..."
	@curl -f http://localhost:8080/api/health || echo "âŒ æœåŠ¡æœªè¿è¡Œ"

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
.PHONY: help
help:
	@echo "Linux é…ç½®ç®¡ç†å™¨åç«¯ - å¯ç”¨å‘½ä»¤:"
	@echo ""
	@echo "  make build      - æ„å»ºåº”ç”¨"
	@echo "  make dev        - è¿è¡Œå¼€å‘æœåŠ¡å™¨"
	@echo "  make run        - æ„å»ºå¹¶è¿è¡Œåº”ç”¨"
	@echo "  make test       - è¿è¡Œæµ‹è¯•"
	@echo "  make fmt        - æ ¼å¼åŒ–ä»£ç "
	@echo "  make vet        - ä»£ç æ£€æŸ¥"
	@echo "  make deps       - ä¸‹è½½ä¾èµ–"
	@echo "  make health     - å¥åº·æ£€æŸ¥"
	@echo "  make clean      - æ¸…ç†æ„å»ºæ–‡ä»¶"
	@echo "  make help       - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"